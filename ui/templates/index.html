{% extends "base.html" %}

{% block title %}
Assistant Configuration
{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h1>Assistant Configuration</h1>
        </div>
        <div class="card-body">
            <h2>Current Voice: <span id="current-voice"></span></h2>
            <div class="form-group">
                <label for="voice-select">Select Voice</label>
                <select id="voice-select" class="form-control">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
            <button onclick="updateVoice()" class="btn btn-primary">Update Voice</button>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>Commands</h2>
        </div>
        <div class="card-body">
            <ul id="commands-list" class="list-group">
                <!-- Commands will be populated dynamically -->
            </ul>
            <div class="form-inline mt-3">
                <input type="text" id="new-command-keyword" class="form-control mr-2" placeholder="Keyword">
                <input type="text" id="new-command-action" class="form-control mr-2" placeholder="Action">
                <button onclick="addCommand()" class="btn btn-success">Add Command</button>
            </div>
        </div>
    </div>
</div>

<!-- Include Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    const apiUrl = '/api/config';

    async function fetchConfig() {
        const response = await fetch(apiUrl);
        const data = await response.json();
        document.getElementById('current-voice').innerText = data.current_voice;
        const voiceSelect = document.getElementById('voice-select');
        voiceSelect.innerHTML = ''; // Clear existing options
        data.voices.forEach(voice => {
            const option = document.createElement('option');
            option.value = voice;
            option.text = voice;
            voiceSelect.add(option);
        });
        const commandsList = document.getElementById('commands-list');
        commandsList.innerHTML = ''; // Clear existing commands
        data.commands.forEach((cmd, index) => {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.innerText = `${cmd.keyword}: ${cmd.action}`;
            commandsList.appendChild(li);
        });
    }

    async function updateVoice() {
        const voice = document.getElementById('voice-select').value;
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ ...config, current_voice: voice }),
        });
        const data = await response.json();
        alert(data.message);
        fetchConfig();
    }

    async function addCommand() {
        const keyword = document.getElementById('new-command-keyword').value;
        const action = document.getElementById('new-command-action').value;
        const response = await fetch('/api/commands', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ keyword, action }),
        });
        const data = await response.json();
        alert(data.message);
        fetchConfig();
    }

    fetchConfig();
</script>
{% endblock %}
